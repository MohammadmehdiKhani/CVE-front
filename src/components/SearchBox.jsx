import React from "react";
import { useState, useEffect, useRef } from "react";
import http from "../services/httpService.js";
import "../style/searchBox.css";

function SearchBox({ options }) {
  const [value, setValue] = useState("");
  const [showSuggestions, setShowSuggestions] = useState(false);

  const SearchBoxRef = useRef(null);

  useEffect(() => {
    document.addEventListener("click", handleClickOutOfSearchBox);

    return () => {
      document.removeEventListener("click", handleClickOutOfSearchBox);
    };
  }, []);

  const soggestions = options.filter((o) =>
    o.toLowerCase().includes(value.toLowerCase())
  );

  const handleChange = (e) => {
    setValue(e.target.value);
  };

  const handleSuggestionsClick = async (s) => {
    console.log(s);
    setValue(s);
    setShowSuggestions(false);

    const response = await http.post("apiEndpoint", value);
  };

  const handleClickOutOfSearchBox = (e) => {
    if (!SearchBoxRef.current.contains(e.target)) {
      setShowSuggestions(false);
    }
  };

  return (
    <div className="SearchBox-container" ref={SearchBoxRef}>
      <input
        value={value}
        placeholder="Search a program"
        onChange={handleChange}
        onFocus={() => setShowSuggestions(true)}
      ></input>
      {showSuggestions && (
        <ul className="suggestions">
          {soggestions.map((s) => (
            <li onClick={() => handleSuggestionsClick(s)} key={s}>
              {s}
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}

export default SearchBox;
