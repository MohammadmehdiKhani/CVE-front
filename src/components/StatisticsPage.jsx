import React, { useState, useEffect } from "react";
import StatisticsTable from "./StatisticsTable";
import http from "../services/httpService.js";
require("dotenv").config();

function StatisticsPage() {
  const [programs, setPrograms] = useState([]);

  useEffect(() => {
    async function fetchData() {
      try {
        const response = await http.get(
          `${process.env.SERVER_BASE_URL}/my-cpes`,
          {
            headers: { "x-auth-token": localStorage.getItem("token") },
          }
        );
        setPrograms(response.data);
        console.log(response.data);
      } catch (e) {
        if (e.response && e.response.status == 401) {
          window.location = "/";
        }
      }
    }
    fetchData();
  }, []);

  return (
    <div className="centeral-container">
      <div className="page-top-title farsi-bold">‌وضعیت امنیت برنامه‌ها</div>
      {programs.length > 0 && (
        <StatisticsTable items={programs}></StatisticsTable>
      )}
      {programs.length <= 0 && (
        <div className="farsi">
          هنوز برنامه‌ای به لیست برنامه‌هایتان اضافه نکرده‌اید.
        </div>
      )}
    </div>
  );
}

export default StatisticsPage;
